
dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","jsonschemavalidator.widget.JSONTextBox"],["require","dijit._Templated"],["require","dijit._Widget"],["require","dijit.layout.ContentPane"],["require","dijit.layout.BorderContainer"],["require","dijit.layout.TabContainer"],["require","dojo.data.ItemFileReadStore"],["require","dijit.MenuBar"],["require","dijit.MenuBarItem"],["require","dijit.PopupMenuBarItem"],["require","dijit.Menu"],["require","dijit.MenuItem"],["require","dijit.form.SimpleTextarea"],["require","dojox.json.schema"],["require","dojo.cache"],["require","jsonschemavalidator.proxy.jsv"],["require","dojox.grid.DataGrid"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["jsonschemavalidator.widget.JSONTextBox"]){_4._hasResource["jsonschemavalidator.widget.JSONTextBox"]=true;_4.provide("jsonschemavalidator.widget.JSONTextBox");_4.require("dijit._Templated");_4.require("dijit._Widget");_4.require("dijit.layout.ContentPane");_4.require("dijit.layout.BorderContainer");_4.require("dijit.layout.TabContainer");_4.require("dojo.data.ItemFileReadStore");_4.require("dijit.MenuBar");_4.require("dijit.MenuBarItem");_4.require("dijit.PopupMenuBarItem");_4.require("dijit.Menu");_4.require("dijit.MenuItem");_4.require("dijit.form.SimpleTextarea");_4.require("dojox.json.schema");_4.require("dojo.cache");_4.require("jsonschemavalidator.proxy.jsv");_4.require("dojox.grid.DataGrid");_4.declare("jsonschemavalidator.widget.JSONTextBox",[_5._Widget,_5._Templated],{templateString:_4.cache("jsonschemavalidator.widget","templates/JSONTextBox.html","<div class=\"JSONTextBox\">\n\t<h2><label dojoAttachPoint=\"titleNode\">${name}</label></h2>\n\t<!-- We use a border container because it handles some weird resize issues for textarea quite nicely -->\n\t<div dojoType=\"dijit.layout.BorderContainer\" design=\"headline\" dojoAttachPoint=\"bc\" gutters=\"false\">\n\t\t<div dojoType=\"dijit.MenuBar\" region=\"top\" dojoAttachPoint=\"menu\">\n\t\t\t<div dojoType=\"dijit.PopupMenuBarItem\">\n\t\t\t\t<span>Edit</span>\n\t\t\t\t<div dojoType=\"dijit.Menu\">\n\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" dojoAttachEvent=\"onClick:_format\" iconClass=\"dijitEditorIcon dijitEditorIconIndent\">\n\t\t\t\t\tFormat JSON\n\t\t\t\t\t</div>\n\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" dojoAttachEvent=\"onClick:_validate\">\n\t\t\t\t\tValidate JSON\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<textarea rows=\"19\" class=\"text\" spellcheck=\"false\" dojoType=\"dijit.form.SimpleTextarea\" region=\"center\" dojoAttachPoint=\"box\" title=\"${name}\" dojoAttachEvent=\"onChange:_onChange, onKeyPress:_onKeyPress\"></textarea>\n\t</div>\n\t<div class=\"errorContainer\" dojoType=\"dijit.layout.TabContainer\" region=\"bottom\">\n\t\t<table dojoType=\"dojox.grid.DataGrid\" title=\"Messages\" dojoAttachPoint=\"messageGrid\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th field=\"property\" width=\"30%\">Path</th>\n\t\t\t\t\t<th field=\"message\" width=\"60%\">Message</th>\n\t\t\t\t\t<th field=\"details\" width=\"10%\">Details</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t</table>\n\t</div>\n</div>\n"),widgetsInTemplate:true,name:"",state:"invalidJson",jsvEnvironmentId:"json-schema-draft-03",value:"",_stateMessages:{"invalidJson":"JSON is invalid.  Try http://jsonlint.com to fix it.","validJson":"JSON is valid, but does not validate against schema.","validatedJson":"JSON validates against schema.","schemaNotReady":"Schema not ready for validation."},constructor:function(){this._jsv=new jsonschemavalidator.proxy.jsv();},buildRendering:function(){var F=this.declaredClass+".";this.inherited(arguments);_4.attr(this.titleNode,"for",this.box.id);},startup:function(){this.inherited(arguments);this.messageGrid.canSort=function(){return false;};this._validate();},_indentStr:"    ",_format:function(){var F=this.declaredClass+".";try{var _7=this._parseValueAsJson();this.box.set("value",this._toIndentedJson(_7));focus(this.box.domNode);}catch(err){}},_toIndentedJson:function(_8){var F=this.declaredClass+".";var _9=_4.toJsonIndentStr;_4.toJsonIndentStr=this._indentStr;var _a=_4.toJson(_8,true);_4.toJsonIndentStr=_9;return _a;},_onChange:function(){var F=this.declaredClass+".";this._validate();},_validate:function(){var F=this.declaredClass+".";try{var _b=this._parseValueAsJson();this.set("state","validJson");this.set("messages",[]);_4.when(this._validateAgainstSchema(_b),_4.hitch(this,function(_c){if(_c&&_4.exists("errors",_c)){if(_c.errors.length===0){this.set("state","validatedJson");this.set("messages",[{message:this._stateMessages.validatedJson}]);}else{var _d=_4.map(_c.errors,function(_e){var _f=(_4.isArray(_e.details)?(_e.details.length>1?_4.toJson(_e.details):_e.details[0]):_e.details);return {property:_e.uri.substring(_e.uri.indexOf("#")+1),attribute:_e.attribute,message:_e.message,details:_f};});_d.unshift({message:this._stateMessages.validJson});this.set("messages",_d);}}}));}catch(err){if(err.name==="SyntaxError"&&err.message==="Invalid JSON!"){this.set("state","invalidJson");this.set("messages",[{message:this._stateMessages.invalidJson}]);}else{if(err.name==="ReferenceError"&&err.message==="schema is not ready"){this.set("messages",[{message:this._stateMessages.schemaNotReady}]);}else{throw err;}}}},_validateAgainstSchema:function(obj){var F=this.declaredClass+".";if(this.schema&&_4.isObject(this.schema)){return this._jsv.load(this.jsvEnvironmentId).then(_4.hitch(this,function(){var env=JSV.createEnvironment(this.jsvEnvironmentId);return env.validate(obj,this.schema);}));}else{throw new ReferenceError("schema is not ready");}},_parseValueAsJson:function(){var F=this.declaredClass+".";var obj;try{obj=_4.fromJson(this.box.get("value"));if(!obj){throw new SyntaxError();}return obj;}catch(err){switch(err.name){case "SyntaxError":case "ReferenceError":throw new SyntaxError("Invalid JSON!");default:throw err;}}},_setStateAttr:function(_10){var F=this.declaredClass+".";_4.removeClass(this.domNode,this.state);this.state=_10;_4.addClass(this.domNode,this.state);this.box.set("title",this._stateMessages[_10]);this.onStateChange(_10);},onStateChange:function(_11){},reset:function(){this.box.set("value","");},_getValueAttr:function(){var F=this.declaredClass+".";return this._parseValueAsJson();},_setValueAttr:function(_12){var F=this.declaredClass+".";this.box.set("value",this._toIndentedJson(_4.isString(_12)?_4.fromJson(_12):_12));},_setSchemaAttr:function(_13){var F=this.declaredClass+".";if(_4.isObject(_13)){this.schema=_13;}else{delete this.schema;}this._validate();},_onKeyPress:function(key){var F=this.declaredClass+".";var _14=false;if(key.ctrlKey&&key.shiftKey&&key.keyChar==="F"){this._format();_14=true;}if(key.ctrlKey&&key.shiftKey&&key.keyChar==="V"){this._validate();_14=true;}if(_14){_4.stopEvent(key);}},_setMessagesAttr:function(_15){this.messageStore=new _4.data.ItemFileReadStore({data:{items:_15}});if(this._started){this.messageGrid.setStore(this.messageStore);}},_setJsvEnvironmentIdAttr:function(id){this.jsvEnvironmentId=id;if(this.started){this._validate();}}});}}};});